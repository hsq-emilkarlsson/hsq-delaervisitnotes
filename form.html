<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Visit Notes - Husqvarna Group</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: #fafafa;
            color: #1a1a1a;
            line-height: 1.5;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 20px 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo {
            height: 48px;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 48px 24px;
        }

        .form-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 2px;
            padding: 48px;
        }

        .form-header {
            margin-bottom: 40px;
        }

        .badges {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .badge {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 4px 10px;
            border-radius: 2px;
        }

        .badge-internal {
            background: #f5f5f5;
            color: #666;
        }

        .badge-powered {
            background: #f5f5f5;
            color: #666;
        }

        h1 {
            font-size: 24px;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 32px;
        }

        label {
            display: block;
            color: #1a1a1a;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
            letter-spacing: 0.01em;
        }

        .required {
            color: #999;
            margin-left: 2px;
            font-weight: 400;
        }

        input[type="date"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d4d4d4;
            border-radius: 2px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.15s ease;
            background: white;
        }

        input[type="date"]:focus,
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        textarea {
            resize: vertical;
            min-height: 180px;
            line-height: 1.6;
        }

        .hint {
            color: #999;
            font-size: 12px;
            margin-top: 6px;
            line-height: 1.5;
        }

        .tip-box {
            background: #fafafa;
            border-left: 2px solid #1a1a1a;
            padding: 16px;
            margin-top: 12px;
            font-size: 12px;
            line-height: 1.6;
        }

        .tip-box strong {
            color: #1a1a1a;
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .tip-box code {
            display: block;
            background: white;
            padding: 12px;
            margin-top: 8px;
            border: 1px solid #e5e5e5;
            border-radius: 2px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            color: #333;
            line-height: 1.5;
        }

        .info-section {
            margin-top: 40px;
            padding-top: 32px;
            border-top: 1px solid #e5e5e5;
        }

        .info-section strong {
            color: #1a1a1a;
            display: block;
            margin-bottom: 12px;
            font-size: 13px;
            font-weight: 500;
        }

        .info-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-section li {
            color: #666;
            font-size: 13px;
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .info-section li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #999;
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 2px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.15s ease;
            margin-top: 8px;
        }

        .submit-btn:hover:not(:disabled) {
            background: #000;
        }

        .submit-btn:disabled {
            background: #d4d4d4;
            cursor: not-allowed;
        }

        .success-message {
            background: #f5f5f5;
            padding: 32px;
            border-radius: 2px;
            margin-bottom: 32px;
            display: none;
            text-align: center;
        }

        .success-message h2 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .success-message button {
            margin-top: 16px;
            padding: 10px 20px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
        }

        .error-message {
            background: #fff5f5;
            border: 1px solid #fdd;
            color: #c33;
            padding: 12px;
            border-radius: 2px;
            margin-bottom: 24px;
            display: none;
            font-size: 13px;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px 16px;
            }

            .form-card {
                padding: 32px 24px;
            }

            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://portal.husqvarnagroup.com/static/b2b/assets/with-name.2c359503.svg" alt="Husqvarna Group" class="logo">
    </div>

    <div class="container">
        <div class="form-card">
                <div id="success-message" class="success-message">
                <h2>Notes submitted</h2>
                <p>Your customer visit notes have been processed successfully.</p>
                <button onclick="resetForm()">Submit Another</button>
            </div>            <div id="error-message" class="error-message"></div>

            <div id="form-container">
                <div class="form-header">
                    <div class="badges">
                        <span class="badge badge-internal">Internal Use Only</span>
                        <span class="badge badge-powered">Powered by n8n</span>
                    </div>
                    <h1>Customer Visit Notes</h1>
                    <p class="subtitle">Document your customer meeting notes and key takeaways. All content will be automatically translated to English and structured for easy sharing.</p>
                </div>

                <form id="visit-form">
                    <div class="form-group">
                        <label for="meeting-date">Meeting Date<span class="required">*</span></label>
                        <input type="date" id="meeting-date" name="meeting-date" required>
                    </div>

                    <div class="form-group">
                        <label for="customer">Customer<span class="required">*</span></label>
                        <input type="text" id="customer" name="customer" placeholder="Company name" required>
                    </div>

                    <div class="form-group">
                        <label for="contact">Contact Person</label>
                        <input type="text" id="contact" name="contact" placeholder="Name and title of person you met">
                        <div class="hint">Optional - e.g., "John Smith, Sales Manager"</div>
                    </div>

                    <div class="form-group">
                        <label for="notes">Meeting Notes<span class="required">*</span></label>
                        <textarea id="notes" name="notes" placeholder="Document key discussion points, customer needs, pain points, opportunities, questions raised, and any commitments made during the meeting..." required></textarea>
                        <div class="hint">
                            Write in any language - it will be automatically translated to English.<br>
                            Tip: Include action items by writing "Action:" or "TODO:" in your notes.
                        </div>
                        <div class="tip-box">
                            <strong>ðŸ’¡ Using AI to prepare your notes?</strong>
                            If you're using ChatGPT or similar to structure your notes before submitting, use this prompt:<br><br>
                            <code>"Clean up and structure my customer meeting notes. Keep all details, names, and specifics intact. Format as clear paragraphs. Include any action items with owners and deadlines if mentioned. Do not translate - keep original language."</code>
                        </div>
                    </div>

                    <div class="info-section">
                        <strong>What happens after submission</strong>
                        <ul>
                            <li>Your notes are automatically translated to English and structured</li>
                            <li>Posted to Microsoft Teams for team visibility</li>
                            <li>Stored in Databricks for analytics and insights</li>
                        </ul>
                    </div>

                    <button type="submit" class="submit-btn" id="submit-btn">Submit Notes</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const authToken = sessionStorage.getItem('hsq_auth');
        const authTime = sessionStorage.getItem('hsq_auth_time');
        const maxSessionTime = 24 * 60 * 60 * 1000; // 24 hours

        if (!authToken || !authTime || (Date.now() - parseInt(authTime)) > maxSessionTime) {
            window.location.href = 'login.html';
        }

        // Set default date to today
        document.getElementById('meeting-date').valueAsDate = new Date();

        // Form submission
        document.getElementById('visit-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submit-btn');
            const errorMessage = document.getElementById('error-message');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span>Submitting...';
            errorMessage.style.display = 'none';

            // Collect form data
            const formData = {
                'Meeting Date': document.getElementById('meeting-date').value,
                'Customer': document.getElementById('customer').value,
                'Contact Person': document.getElementById('contact').value,
                'Meeting Notes': document.getElementById('notes').value
            };

            try {
                // Create form data object
                const formData = {
                    'Meeting Date': document.getElementById('meeting-date').value,
                    'Customer': document.getElementById('customer').value,
                    'Contact Person': document.getElementById('contact').value,
                    'Meeting Notes': document.getElementById('notes').value,
                    'formMode': 'production'
                };

                console.log('Sending data:', formData);

                // Submit to n8n webhook as JSON
                const response = await fetch('https://husqvarna-prod.app.n8n.cloud/webhook/9a05b897-4122-4677-a608-a9d4f3e9a7f1', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('Response status:', response.status);
                const responseText = await response.text();
                console.log('Response body:', responseText);

                if (response.ok) {
                    // Success
                    document.getElementById('form-container').style.display = 'none';
                    document.getElementById('success-message').style.display = 'block';
                } else {
                    throw new Error(`Submission failed: ${response.status} - ${responseText}`);
                }
            } catch (error) {
                // Error
                console.error('Submission error:', error);
                errorMessage.textContent = 'Failed to submit form: ' + error.message;
                errorMessage.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Notes';
            }
        });

        function resetForm() {
            document.getElementById('visit-form').reset();
            document.getElementById('meeting-date').valueAsDate = new Date();
            document.getElementById('form-container').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
        }
    </script>
</body>
</html>
